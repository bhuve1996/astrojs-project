---
import { loadWebsiteData } from "../utils/data-loader";
import "../utils/client/styles.css";

interface Props {
  title?: string;
  description?: string;
}

const { title, description } = Astro.props;
const data = await loadWebsiteData();
const firstPage = data.pages[0];
const meta = firstPage?.structure.meta || {};
const pageTitle = title || firstPage?.structure.title || meta.ogTitle || "Cloned Website";
const pageDescription = description || meta.description || meta.ogDescription || "";
const faviconPath = data.assets.favicon?.localPath ? `/${data.assets.favicon.localPath}` : "/favicon.svg";
const faviconType = data.assets.favicon?.type || (faviconPath.endsWith('.svg') ? 'image/svg+xml' : 'image/x-icon');
---

<!doctype html>
<html lang={meta.lang || "en"}>
  <head>
    <meta charset={meta.charset || "UTF-8"} />
    <meta name="viewport" content={meta.viewport || "width=device-width, initial-scale=1.0"} />
    <meta name="description" content={pageDescription} />
    {meta.keywords && <meta name="keywords" content={meta.keywords} />}
    {meta.author && <meta name="author" content={meta.author} />}
    {meta.robots && <meta name="robots" content={meta.robots} />}
    {meta.themeColor && <meta name="theme-color" content={meta.themeColor} />}
    
    <!-- Open Graph -->
    {meta.ogTitle && <meta property="og:title" content={meta.ogTitle} />}
    {meta.ogDescription && <meta property="og:description" content={meta.ogDescription} />}
    {meta.ogImage && <meta property="og:image" content={meta.ogImage} />}
    {meta.ogUrl && <meta property="og:url" content={meta.ogUrl} />}
    {meta.ogType && <meta property="og:type" content={meta.ogType} />}
    {meta.ogSiteName && <meta property="og:site_name" content={meta.ogSiteName} />}
    {meta.ogLocale && <meta property="og:locale" content={meta.ogLocale} />}
    
    <!-- Twitter Card -->
    {meta.twitterCard && <meta name="twitter:card" content={meta.twitterCard} />}
    {meta.twitterTitle && <meta name="twitter:title" content={meta.twitterTitle} />}
    {meta.twitterDescription && <meta name="twitter:description" content={meta.twitterDescription} />}
    {meta.twitterImage && <meta name="twitter:image" content={meta.twitterImage} />}
    {meta.twitterSite && <meta name="twitter:site" content={meta.twitterSite} />}
    {meta.twitterCreator && <meta name="twitter:creator" content={meta.twitterCreator} />}
    
    <!-- Canonical -->
    {meta.canonical && <link rel="canonical" href={meta.canonical} />}
    
    <!-- Favicon -->
    <link rel="icon" type={faviconType} href={faviconPath} />
    
    <meta name="generator" content={Astro.generator} />
    <title>{pageTitle}</title>
    
    <!-- Load scraped CSS first (original website styles) -->
    {data.assets.css.map((css, i) => (
      css.localPath ? (
        <link rel="stylesheet" href={`/${css.localPath}`} />
      ) : null
    ))}
    
    <!-- Interactive components styles (scoped, won't interfere) -->
  </head>
  <body>
    <slot />
    
    <!-- Load scraped JS -->
    {data.assets.js.map((js, i) => (
      js.localPath ? (
        <script src={`/${js.localPath}`}></script>
      ) : null
    ))}
    
    <!-- Load interactive components -->
    <script type="module">
      import { initInteractiveComponents } from '../utils/client/index';
      initInteractiveComponents();
    </script>
  </body>
</html>

<style is:global>
  /* Minimal reset - only box-sizing to avoid breaking scraped styles */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }
</style>
